box: python:3.4-slim
services:
    - postgres
build:
  steps:
    - script:
        name: install requirements
        code: |
          sudo apt-get update
          sudo sh ./scripts/bootstrap.sh
    - script:
        name: setup virtual env
        code: |
          . .env
    - script:
        name: update setuptools
        code: |
          sudo pip install -U setuptools
    - script:
        name: create dev env
        code: |
          make dev
    - script:
        name: sync database
        code: |
          make sync
deploy:
  steps:
    - heroku-deploy:
        key: $HEROKU_KEY
        user: $HEROKU_USER
        app-name: $HEROKU_APP_NAME
        key-name: HEROKU_KEY_PAIR
