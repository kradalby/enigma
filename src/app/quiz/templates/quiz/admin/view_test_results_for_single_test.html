{% extends "base/admin/index.html" %}
{% load question_tags %}

{% block admincontent %}
<style>
    .img-container { 
        position: relative; 
        max-height: 500px;
        max-width: 500px;
    }

    .img-container .top {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
    }
    
    .img-container img {
        width: 100%;
    }
    
    .pagination>.disabled>a, 
    .pagination>.disabled>a:focus, 
    .pagination>.disabled>a:hover, 
    .pagination>.disabled>span, 
    .pagination>.disabled>span:focus, 
    .pagination>.disabled>span:hover {
        z-index: 3;
        color: black;
        cursor: default;
        background-color: #ddd;
        border-color: #ddd;
    }
</style>
<div class="page-header">
  <h1>Test results for {{ test }}</h1>
</div>
<nav>
  <ul class="pagination">
    <li>
      <a id="previous" class="navigation" href="#" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    {% for test_unit in test_units %}
    <li>
        <a id="{{ forloop.counter }}" class="navigation" href="#">{{ forloop.counter }}</a>
    </li>
    {% endfor %}
    <li>
      <a id="next" class="navigation" href="#" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>
{% for test_unit in test_units %}
<div class="test-result" id="{{ forloop.counter }}">
    <div class="panel panel-info">
        <div class="panel-heading">
            <h3 class="panel-title">Question {{ forloop.counter }}</h3>
        </div>
        <table class="table">
            <tr>
                <th>Question</th>
                <td>{{ test_unit }}</td>
            </tr>
            <tr>
                <th>Correct answer</th>
                <td>
                    {% if test_unit|is_landmark %}
                        <div class="img-container">
                            <img class="top" src="{{ test_unit.landmarkquestion.landmark_drawing.url }}" />
                            <img class="bottom" src="{{ test_unit.landmarkquestion.original_image.url }}" />
                        </div>
                    {% elif test_unit|is_outline %}
                        <div class="img-container">
                            <img class="top" src="{{ test_unit.outlinequestion.outline_drawing.url }}" />
                            <img class="bottom" src="{{ test_unit.outlinequestion.original_image.url }}" />
                        </div>
                    {% elif test_unit|is_multiple_choice_question %}
                        {{ test_unit.multiplechoicequestion.correct_answer }}
                    {% elif test_unit|is_multiple_choice_question_with_image %}
                        {{ test_unit.multiplechoicequestionwithimage.correct_answer }}
                    {% elif test_unit|is_multiple_choice_question_with_video %}
                        {{ test_unit.multiplechoicequestionwithvideo.correct_answer }}
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>

    <div class="panel panel-info">
        <div class="panel-heading">
            <h3 class="panel-title">Answers</h3>
        </div>
        <table class="table">
            {% for test_unit_result in test_unit_results %}
                {% if test_unit_result.test_unit == test_unit %}
                <tr>
                    <th>{{ test_unit_result.test_result.user }}'s answer</th>
                    <td>
                        {% if test_unit|is_landmark %}
                            <table class="table">
                                <tr>
                                    <td>Target region </td>
                                    <td style="color:{{test_unit_result.target_color_region}};">
                                        {{ test_unit_result.target_landmark_region }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>Answered region</td>
                                    <td style="color:{{test_unit_result.answer}};">
                                        {{ test_unit_result.answered_landmark_region }}
                                    </td>
                                </tr>
                            </table>
    
                            <div class="img-container">
                                <img class="top" src="{{ test_unit_result.answer_image.url }}" />
                                <img class="bottom" src="{{ test_unit.landmarkquestion.original_image.url }}" />
                            </div>
                        {% elif test_unit|is_outline %}
                            <table class="table">
                                <tr>
                                    <td>Target region </td>
                                    <td style="color:{{test_unit_result.target_color_region}};">
                                        {{ test_unit_result.target_outline_region }}
                                    </td>
                                </tr>
                            </table>
                            <div class="img-container">
                                <img class="top" src="{{ test_unit_result.answer_image.url }}" />
                                <img class="bottom" src="{{ test_unit.outlinequestion.original_image.url }}" />
                            </div>
                        {% elif test_unit|is_multiple_choice_question %}
                            {{ test_unit_result.answer }}
                        {% elif test_unit|is_multiple_choice_question_with_image %}
                            {{ test_unit_result.answer }}
                        {% elif test_unit|is_multiple_choice_question_with_video %}
                            {{ test_unit_result.answer }}
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
            {% endfor %}
        </table>
    </div>
</div>
{% endfor %}
{% endblock %}

{% block end %}
<script>
    function disableAndEnableNavigationButtons(){
        // Default
        $("a.navigation").parent().removeClass('disabled');
        $("a.navigation").parent().removeClass('active');
        
        var currentlyVisible = $('div.test-result:visible');
        if(currentlyVisible.next('div.test-result').length <= 0){
            $("a#next").parent().addClass('disabled');
        } 
        if(currentlyVisible.prev('div.test-result').length <= 0){
            $("a#previous").parent().addClass('disabled');
        }
        // console.log()
        $("a#"+currentlyVisible.attr('id')+".navigation").parent().addClass('active');
    }
    
    $('div.test-result').hide().first().show();
    $('a.navigation').on('click', function(e) {
        e.preventDefault();
        if($(this).parent().hasClass("disabled")){
            return;
        }
        var currentlyVisible = $('div.test-result:visible');
        var t = $(this).attr('id');

        $('div.test-result').hide();
        if (t === 'next' && currentlyVisible.next('div.test-result').length > 0) {
            currentlyVisible.next('div.test-result').show();
        } else if (t === 'previous' && currentlyVisible.prev('div.test-result').length > 0) {
            currentlyVisible.prev('div.test-result').show();
        } else if (!isNaN(t)){
            $("div#" + t + ".test-result").show();
        }
        disableAndEnableNavigationButtons();
    });
    disableAndEnableNavigationButtons();
</script>
{% endblock %}